{% extends "base.html" %}
{% block content %}

<h2 style="text-align:center; margin-top:20px;">Tour Availability</h2>

<div id="calendar" style="max-width:900px; margin:40px auto; min-height:500px;"></div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async function () {

    const tourId = 1;

    const response = await fetch(`/api/bookings/${tourId}`);
    const bookings = await response.json();

    console.log("BOOKINGS:", bookings);

    const events = bookings.map(b => ({
        title: "Booked",
        start: b.date,
        display: "background",
        color: "#e53935"
    }));

    const calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: "dayGridMonth",
        events: events,
        validRange: {
            start: new Date().toISOString().split("T")[0]
        },
        dateClick: function(info) {

            const isBooked = bookings.some(b => b.date === info.dateStr);

            if (isBooked) {
                alert("This date is already booked.");
                return;
            }

            alert("Selected date: " + info.dateStr);
        }
    });

    calendar.render();
});
</script>

{% endblock %}